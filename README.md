# Docker Setup –¥–ª—è AI Study MVP

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker 20.10+
- Docker Compose 1.29+
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) NVIDIA Docker –¥–ª—è GPU –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Xenox-developer/Junior-ML-Contest.git
cd Junior-ML-Contest

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à OPENAI_API_KEY

# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x build.sh run-docker.sh
```

### 3. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –í–∞—Ä–∏–∞–Ω—Ç 1: CPU –≤–µ—Ä—Å–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)
```bash
# –°–±–æ—Ä–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: GPU –≤–µ—Ä—Å–∏—è
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω NVIDIA Docker
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.gpu.yml up -d
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ó–∞–ø—É—Å–∫ —Å hot-reload
docker-compose -f docker-compose.dev.yml up
```

#### –í–∞—Ä–∏–∞–Ω—Ç 4: Production —Å Nginx
```bash
# –ó–∞–ø—É—Å–∫ —Å Nginx reverse proxy
docker-compose --profile production up -d
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
.
‚îú‚îÄ‚îÄ Dockerfile              # –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–∑ (CPU)
‚îú‚îÄ‚îÄ Dockerfile.gpu          # GPU –≤–µ—Ä—Å–∏—è —Å CUDA
‚îú‚îÄ‚îÄ docker-compose.yml      # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.dev.yml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ docker-compose.gpu.yml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è GPU
‚îú‚îÄ‚îÄ .dockerignore          # –ò—Å–∫–ª—é—á–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ nginx.conf             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ build.sh               # –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ run-docker.sh          # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
OPENAI_API_KEY=sk-...

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
MAX_UPLOAD_MB=200
MAX_TEXT_CHARS=50000  # –õ–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (20-25 —Å—Ç—Ä–∞–Ω–∏—Ü)
FLASK_ENV=production
SECRET_KEY=your-secret-key-here
```

## üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (v2.0)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ 20+ —Å—Ç—Ä–∞–Ω–∏—Ü** (50,000 —Å–∏–º–≤–æ–ª–æ–≤)
- **–£–º–Ω–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –∏–∑ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–ª–µ—à-–∫–∞—Ä—Ç** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤

### –õ–∏–º–∏—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –¥–æ 200 –ú–ë (PDF, –≤–∏–¥–µ–æ)
- **–¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞**: –¥–æ 50,000 —Å–∏–º–≤–æ–ª–æ–≤ (~20-25 —Å—Ç—Ä–∞–Ω–∏—Ü)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ**: –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±–æ–ª—å—à–µ 15,000 —Å–∏–º–≤–æ–ª–æ–≤
- **–§–ª–µ—à-–∫–∞—Ä—Ç—ã**: –¥–æ 20 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
1. **–ú–∞–ª—ã–µ —Ç–µ–∫—Å—Ç—ã** (–¥–æ 15–ö —Å–∏–º–≤–æ–ª–æ–≤) - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º
2. **–°—Ä–µ–¥–Ω–∏–µ —Ç–µ–∫—Å—Ç—ã** (15–ö-50–ö —Å–∏–º–≤–æ–ª–æ–≤) - –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã
3. **–ë–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç—ã** (50–ö+ —Å–∏–º–≤–æ–ª–æ–≤) - —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏ —Å —É–º–Ω—ã–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### Volumes
- `./uploads:/app/uploads` - –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `./data:/app/data` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
- `whisper_cache` - –∫—ç—à –º–æ–¥–µ–ª–µ–π Whisper
- `huggingface_cache` - –∫—ç—à –º–æ–¥–µ–ª–µ–π HuggingFace

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f app

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose exec app bash

# –û—á–∏—Å—Ç–∫–∞ volumes
docker-compose down -v
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker-compose build --no-cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker-compose exec app curl http://localhost:5000/
```

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Out of memory –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∏–¥–µ–æ**
   - –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –ø–∞–º—è—Ç–∏ –≤ docker-compose.yml
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU –≤–µ—Ä—Å–∏—é –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

2. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU –≤–µ—Ä—Å–∏–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ volumes

3. **Permission denied**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ uploads –∏ data
   - `sudo chown -R 1000:1000 uploads data`

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ GPU
```yaml
# –í docker-compose.gpu.yml
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          count: 1
          capabilities: [gpu]
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–º—è—Ç–∏
```yaml
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
deploy:
  resources:
    limits:
      memory: 16G
    reservations:
      memory: 8G
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
–ú–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ named volumes –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets –¥–ª—è API –∫–ª—é—á–µ–π**
   ```yaml
   secrets:
     openai_key:
       file: ./secrets/openai_key.txt
   ```

2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø**
   ```yaml
   networks:
     ai_study_network:
       internal: true
   ```

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã**
   ```bash
   docker-compose pull
   docker-compose build --no-cache
   ```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å—Ç–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –°–æ–∑–¥–∞–π—Ç–µ docker-compose.monitoring.yml
services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
  
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
```