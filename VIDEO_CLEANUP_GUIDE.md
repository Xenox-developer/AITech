# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

–¢–µ–ø–µ—Ä—å –≤—Å–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –ø–∞–ø–∫–∏ `uploads` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ –æ—Ç–º–µ–Ω—ã, —á—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## üîß –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞**
```python
# –í analysis_manager.py - start_video_analysis_task()
# ‚úÖ –£–õ–£–ß–®–ï–ù–û: –£–¥–∞–ª—è–µ–º –≤–∏–¥–µ–æ—Ñ–∞–π–ª –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
if Path(filepath).exists():
    file_size = Path(filepath).stat().st_size
    Path(filepath).unlink()
    logger.info(f"üóëÔ∏è Video file deleted after successful analysis: {filename} ({file_size} bytes)")
```

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∞–Ω–∞–ª–∏–∑–∞**
```python
# –í analysis_manager.py - –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–¥–∞—á–∏
if self.is_task_cancelled(task_id):
    if Path(filepath).exists():
        file_size = Path(filepath).stat().st_size
        Path(filepath).unlink()
        logger.info(f"üóëÔ∏è Video file deleted after cancellation: {filename} ({file_size} bytes)")
```

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö**
```python
# –í analysis_manager.py - –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
except Exception as e:
    if Path(filepath).exists():
        file_size = Path(filepath).stat().st_size
        Path(filepath).unlink()
        logger.info(f"üóëÔ∏è Video file deleted after error: {filename} ({file_size} bytes)")
```

### 4. **–û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–≥—Ä—É–∑–∫–∏**
```python
# –í app.py - download_video_from_url()
except Exception as e:
    if "cancelled" in str(e).lower():
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        for file in new_files:
            file_path = os.path.join(upload_folder, file)
            if os.path.exists(file_path):
                os.remove(file_path)
                logger.info(f"üóëÔ∏è Removed cancelled download: {file}")
```

### 5. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤**
```python
# –í analysis_manager.py - cleanup_orphaned_files()
def cleanup_orphaned_files(self, upload_folder: str = "uploads", max_age_hours: int = 24):
    """–û—á–∏—Å—Ç–∫–∞ –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ uploads"""
    # –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
```

### 6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—á–∏—Å—Ç–∫–∏**
```python
# –í app.py - –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
def start_background_cleanup():
    """–ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤"""
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∏ –∑–∞–¥–∞—á–∏
```

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞:**

1. **üì• –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ**
   - –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `uploads/`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ë–î

2. **üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ**
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —á–µ—Ä–µ–∑ Whisper
   - –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —á–µ—Ä–µ–∑ GPT
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

3. **üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** (–æ–¥–∏–Ω –∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤):
   - **‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ** ‚Üí —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - **‚èπÔ∏è –û—Ç–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º** ‚Üí —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - **‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏** ‚Üí —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
   - **‚è∞ –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª** ‚Üí —É–¥–∞–ª—è–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º (>24 —á–∞—Å–æ–≤)

### **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—á–∏—Å—Ç–∫–∏:**
- **–ó–∞–ø—É—Å–∫**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- **–ß–∞—Å—Ç–æ—Ç–∞**: –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- **–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç**:
  - –ó–∞–¥–∞—á–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
  - –§–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤ (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏)

## üõ†Ô∏è API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–æ–π:

### **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–∞–π–ª–æ–≤:**
```bash
GET /api/cleanup/status
```
**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "stats": {
    "total_files": 15,
    "total_size_mb": 245.7,
    "old_files": 3,
    "old_size_mb": 67.2,
    "active_files": 2
  }
}
```

### **–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤):**
```bash
POST /api/cleanup/files
Content-Type: application/json

{
  "upload_folder": "uploads",
  "task_days": 7,
  "file_hours": 24
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:**
```bash
cd AITech

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
python test_video_cleanup.py
```

### **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

1. **–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ `uploads/`

2. **–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã:**
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ
   - –û—Ç–º–µ–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ `uploads/`

3. **–¢–µ—Å—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:**
   - –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª –≤ `uploads/`
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 6 —á–∞—Å–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

### **–õ–æ–≥–∏ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:**
```
üóëÔ∏è Video file deleted after successful analysis: video.mp4 (15728640 bytes)
üóëÔ∏è Video file deleted after cancellation: video.mp4 (8294400 bytes)
üóëÔ∏è Video file deleted after error: video.mp4 (12582912 bytes)
üóëÔ∏è Removed cancelled download: temp_video.mp4
```

### **–õ–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:**
```
üßπ Starting scheduled cleanup...
üóëÔ∏è Removed orphaned file: old_video.mp4 (25165824 bytes, 26.3h old)
‚úÖ Cleanup completed: 3 files removed, 67.2 MB freed
‚úÖ Scheduled cleanup completed
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã:

### **–≠–∫–æ–Ω–æ–º–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞:**
- ‚úÖ –í–∏–¥–µ–æ—Ñ–∞–π–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (—É—Å–ø–µ—Ö, –æ—Ç–º–µ–Ω–∞, –æ—à–∏–±–∫–∞)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### **–£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å:**
- ‚úÖ API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—á–∏—Å—Ç–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏:

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (–≤ app.py):**
```python
# –ß–∞—Å—Ç–æ—Ç–∞ –æ—á–∏—Å—Ç–∫–∏
time.sleep(6 * 60 * 60)  # 6 —á–∞—Å–æ–≤

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—á–∏—Å—Ç–∫–∏
analysis_manager.cleanup_all(
    upload_folder='uploads',
    task_days=7,      # –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
    file_hours=24     # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
)
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—á–∏—Å—Ç–∫–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `start_background_cleanup()` –≤ —Ñ–∞–π–ª–µ `app.py`.

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!**

- ‚úÖ **–í–∏–¥–µ–æ—Ñ–∞–π–ª—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è** –≤ –ø–∞–ø–∫–µ uploads
- ‚úÖ **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —ç–∫–æ–Ω–æ–º–∏—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å–∞–º–æ–æ—á–∏—â–∞–µ—Ç—Å—è** –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –Ω–∞ 100%!** üéØ

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –¥–æ–ª–≥–æ –±–µ–∑ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏—Å–∫–∞.