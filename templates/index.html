{% extends "base.html" %}

{% block title %}AI-–∫–æ–Ω—Å–ø–µ–∫—Ç Pro - –†–µ–≤–æ–ª—é—Ü–∏—è –≤ –æ–±—É—á–µ–Ω–∏–∏{% endblock %}

{% block extra_styles %}
<style>
    /* CSS Variables for consistent theming */
    :root {
        --primary: #6366f1;
        --secondary: #06b6d4;
        --success: #10b981;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
        --bg-tertiary: #f3f4f6;
        --bg-glass: rgba(255, 255, 255, 0.9);
        --border-primary: #e5e7eb;
        --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    /* Override base styles for better contrast */
    html, body {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        background-attachment: fixed;
        min-height: 100vh;
        color: var(--text-primary);
    }

    body {
        background-color: #f8fafc; /* Fallback color */
    }

    /* Compact Layout - No scrolling needed */
    .hero {
        padding: 20px 0 30px;
        text-align: center;
    }

    .hero-title {
        font-size: 2.2rem;
        font-weight: 900;
        margin-bottom: 12px;
        background: linear-gradient(135deg, #f8fafc 0%, #6366f1 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero-subtitle {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 20px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Main Upload Section */
    .upload-section {
        padding: 20px 0;
    }

    .upload-container {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(99, 102, 241, 0.3);
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 0 40px rgba(99, 102, 241, 0.15);
    }

    .upload-tabs {
        display: flex;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid var(--border-primary);
        border-radius: 16px;
        padding: 6px;
        margin-bottom: 24px;
    }

    .upload-tab {
        flex: 1;
        padding: 12px 20px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 0.9rem;
    }

    .upload-tab.active {
        background: var(--gradient-primary);
        color: white;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    .upload-content {
        display: none;
    }

    .upload-content.active {
        display: block;
    }

    /* Upload Area */
    .upload-area {
        border: 2px dashed var(--border-primary);
        border-radius: 16px;
        padding: 40px 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .upload-area:hover {
        border-color: var(--primary);
        background: rgba(99, 102, 241, 0.05);
        transform: translateY(-2px);
    }

    .upload-area.dragover {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.05);
    }

    .upload-icon {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 16px;
    }

    .upload-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--text-primary);
    }

    .upload-subtitle {
        color: var(--text-secondary);
        margin-bottom: 16px;
        font-size: 0.85rem;
    }

    .file-types {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin: 16px 0;
        flex-wrap: wrap;
    }

    .file-type {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid var(--border-primary);
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 0.8rem;
        color: var(--text-primary);
    }

    .file-type.disabled {
        background: rgba(243, 244, 246, 0.5);
        border: 1px dashed #d1d5db;
        opacity: 0.7;
        cursor: not-allowed;
    }

    /* File Selected */
    .file-selected {
        display: none;
        text-align: center;
        padding: 24px;
        background: var(--bg-glass);
        border-radius: 16px;
        margin-top: 16px;
        border: 1px solid var(--border-primary);
    }

    .file-icon {
        font-size: 2rem;
        color: var(--success);
        margin-bottom: 12px;
    }

    .file-name {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 6px;
    }

    .file-size {
        color: var(--text-secondary);
        margin-bottom: 16px;
        font-size: 0.85rem;
    }

    /* Page Selection */
    .page-selection {
        display: none;
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid var(--border-primary);
        border-radius: 12px;
        padding: 16px;
        margin: 16px 0;
    }

    .page-selection-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }

    .page-input {
        width: 100%;
        padding: 10px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        color: var(--text-primary);
        font-size: 0.85rem;
        margin-bottom: 10px;
    }

    .page-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    .quick-buttons {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .quick-btn {
        padding: 4px 10px;
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid var(--border-primary);
        border-radius: 8px;
        color: var(--text-primary);
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .quick-btn:hover,
    .quick-btn.active {
        background: var(--gradient-primary);
        color: white;
    }

    /* Page recommendation info */
    .page-info {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(5, 150, 105, 0.12) 100%);
        border: 1px solid rgba(16, 185, 129, 0.25);
        border-radius: 12px;
        padding: 16px;
        margin: 12px 0;
        font-size: 0.8rem;
        color: var(--text-primary);
        position: relative;
        overflow: hidden;
    }

    .page-info::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #10b981 0%, #059669 100%);
        border-radius: 0 2px 2px 0;
    }

    .page-info h6 {
        color: #059669;
        margin-bottom: 12px;
        font-size: 0.9rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .page-info h6 i {
        font-size: 1rem;
        color: #10b981;
    }

    .page-recommendations {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .page-recommendation-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 8px;
        transition: all 0.3s ease;
        border: 1px solid rgba(16, 185, 129, 0.15);
    }

    .page-recommendation-item:hover {
        background: rgba(255, 255, 255, 0.8);
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
    }

    .recommendation-icon {
        width: 20px;
        height: 20px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.7rem;
        flex-shrink: 0;
    }

    .recommendation-text {
        flex: 1;
        font-size: 0.8rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .recommendation-pages {
        font-weight: 700;
        color: #059669;
    }

    /* URL Upload */
    .url-input {
        width: 100%;
        padding: 14px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid var(--border-primary);
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 0.9rem;
        margin-bottom: 16px;
        text-align: center;
    }

    .url-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    .url-info {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.08) 0%, rgba(14, 165, 233, 0.12) 100%);
        border: 1px solid rgba(6, 182, 212, 0.25);
        border-radius: 12px;
        padding: 16px;
        margin: 12px 0;
        font-size: 0.8rem;
        color: var(--text-primary);
        position: relative;
        overflow: hidden;
    }

    .url-info::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #06b6d4 0%, #0ea5e9 100%);
        border-radius: 0 2px 2px 0;
    }

    .url-info h6 {
        color: #0891b2;
        margin-bottom: 12px;
        font-size: 0.9rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .url-info h6 i {
        font-size: 1rem;
        color: #06b6d4;
    }

    .url-limitations {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .url-limitation-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 8px;
        transition: all 0.3s ease;
        border: 1px solid rgba(6, 182, 212, 0.15);
    }

    .url-limitation-item:hover {
        background: rgba(255, 255, 255, 0.8);
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.15);
    }

    .limitation-icon {
        width: 20px;
        height: 20px;
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.7rem;
        flex-shrink: 0;
    }

    .limitation-text {
        flex: 1;
        font-size: 0.8rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .limitation-value {
        font-weight: 700;
        color: #0891b2;
    }

    /* Compact Features */
    .features-compact {
        padding: 30px 0;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 20px;
    }

    .feature-card {
        background: var(--bg-glass);
        border: 1px solid var(--border-primary);
        border-radius: 16px;
        padding: 20px 16px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
    }

    .feature-icon {
        width: 50px;
        height: 50px;
        background: var(--gradient-primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 12px;
        font-size: 1.2rem;
        color: white;
    }

    .feature-title {
        font-size: 0.95rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--text-primary);
    }

    .feature-description {
        color: var(--text-secondary);
        font-size: 0.8rem;
        line-height: 1.4;
    }

    /* Processing Modal */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: var(--bg-secondary);
        border: 1px solid var(--border-primary);
        border-radius: 24px;
        padding: 32px;
        max-width: 450px;
        width: 90%;
        text-align: center;
    }

    .processing-icon {
        width: 70px;
        height: 70px;
        background: var(--gradient-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        font-size: 1.8rem;
        color: white;
        animation: pulse 2s infinite;
    }

    .processing-title {
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--text-primary);
    }

    .processing-subtitle {
        color: var(--text-secondary);
        margin-bottom: 20px;
        font-size: 0.85rem;
    }

    .progress-bar {
        width: 100%;
        height: 12px;
        background: var(--bg-tertiary);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
        position: relative;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .progress-fill {
        height: 100%;
        background: var(--gradient-primary);
        width: 0%;
        transition: width 0.5s ease;
        position: relative;
        border-radius: 12px;
    }
    
    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–µ—Å–∫ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
    .modal .progress-fill {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
        background-size: 200% 100%;
        animation: progressShine 2s infinite;
    }
    
    @keyframes progressShine {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: shimmer 2s infinite;
    }

    .progress-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
        z-index: 1;
    }

    .upload-progress {
        display: none;
        background: var(--bg-glass);
        border: 1px solid var(--border-primary);
        border-radius: 16px;
        padding: 24px;
        margin-top: 16px;
        text-align: center;
    }

    .upload-progress.active {
        display: block;
    }

    .upload-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 12px;
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

    .upload-speed {
        font-weight: 600;
    }

    .upload-eta {
        font-weight: 600;
    }

    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Social Proof Section */
    .social-proof-section {
        text-align: center;
        padding: 40px 0;
        margin-top: 40px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 20px;
        backdrop-filter: blur(10px);
    }

    .social-proof-section h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: var(--text-primary);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 30px;
        max-width: 600px;
        margin: 0 auto;
    }

    .stat-item {
        text-align: center;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--primary);
        margin-bottom: 8px;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
    }

    /* CTA Section */
    .cta-section {
        text-align: center;
        padding: 50px 30px;
        margin-top: 40px;
        background: var(--gradient-primary);
        border-radius: 24px;
        color: white;
    }

    .cta-section h3 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 12px;
    }

    .cta-section p {
        font-size: 1rem;
        margin-bottom: 30px;
        opacity: 0.9;
    }

    .cta-buttons {
        display: flex;
        gap: 16px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-large {
        padding: 15px 30px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary.btn-large {
        background: white;
        color: var(--primary);
        border: 2px solid white;
    }

    .btn-primary.btn-large:hover {
        background: transparent;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 255, 255, 0.3);
    }

    .btn-outline.btn-large {
        background: transparent;
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .btn-outline.btn-large:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: white;
        transform: translateY(-2px);
    }

    /* Modern Subscription Limits */
    .subscription-limits-modern {
        margin-bottom: 24px;
    }

    .limits-card-modern {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.08);
        backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
    }

    .limits-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
        border-radius: 20px 20px 0 0;
        animation: gradientShift 3s ease-in-out infinite;
    }

    @keyframes gradientShift {
        0%, 100% { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%); }
        50% { background: linear-gradient(135deg, #06b6d4 0%, #6366f1 50%, #8b5cf6 100%); }
    }

    .limits-header-modern {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .plan-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .plan-badge-modern {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        color: var(--text-primary);
        font-size: 1rem;
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border-radius: 12px;
        border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .plan-badge-modern i {
        color: #f59e0b;
        font-size: 1.1rem;
        filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.3));
    }

    .upgrade-btn-modern {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        position: relative;
        overflow: hidden;
    }

    .upgrade-btn-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }

    .upgrade-btn-modern:hover::before {
        left: 100%;
    }

    .upgrade-btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
    }

    .limits-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
    }

    .limit-card {
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(99, 102, 241, 0.15);
        border-radius: 16px;
        padding: 16px;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ */
    .analyses-card {
        border-color: rgba(16, 185, 129, 0.2);
    }

    .analyses-card:hover {
        border-color: rgba(16, 185, 129, 0.4);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.15);
    }

    .pdf-card {
        border-color: rgba(239, 68, 68, 0.2);
    }

    .pdf-card:hover {
        border-color: rgba(239, 68, 68, 0.4);
        box-shadow: 0 8px 20px rgba(239, 68, 68, 0.15);
    }

    .video-card {
        border-color: rgba(6, 182, 212, 0.2);
    }

    .video-card:hover {
        border-color: rgba(6, 182, 212, 0.4);
        box-shadow: 0 8px 20px rgba(6, 182, 212, 0.15);
    }

    .video-card.disabled-card {
        border-color: rgba(156, 163, 175, 0.3);
        opacity: 0.7;
    }

    .video-card.disabled-card:hover {
        border-color: rgba(156, 163, 175, 0.3);
        box-shadow: none;
        transform: none;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö */
    .limit-icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 12px;
        font-size: 1.2rem;
        color: white;
        transition: all 0.3s ease;
    }

    .analyses-card .limit-icon {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .pdf-card .limit-icon {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .video-card .limit-icon {
        background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    }

    .video-card.disabled-card .limit-icon {
        background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
    }

    .limit-card:hover .limit-icon {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .limit-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .limit-card:hover::before {
        transform: scaleX(1);
    }

    .limit-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
        background: rgba(255, 255, 255, 0.9);
    }

    .limit-header {
        margin-bottom: 12px;
    }

    .limit-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .limit-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }

    .limit-value-large {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1.2;
    }

    .limit-value-disabled {
        font-size: 1rem;
        font-weight: 600;
        color: #9ca3af;
        opacity: 0.8;
    }

    .limit-suffix {
        font-size: 0.9rem;
        color: var(--success);
        font-weight: 600;
    }

    .progress-bar-modern {
        width: 100%;
        height: 6px;
        background: rgba(99, 102, 241, 0.1);
        border-radius: 6px;
        overflow: hidden;
        position: relative;
    }

    .progress-bar-modern .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-radius: 6px;
        transition: width 0.8s ease;
        position: relative;
    }

    .progress-bar-modern .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        animation: modernShimmer 2s infinite;
    }

    @keyframes modernShimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Responsive –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ */
    @media (max-width: 768px) {
        .limits-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .limits-header-modern {
            flex-direction: column;
            gap: 16px;
            align-items: stretch;
        }

        .plan-badge-modern {
            justify-content: center;
        }

        .upgrade-btn-modern {
            justify-content: center;
        }

        .limit-card {
            padding: 20px 16px;
        }

        .limits-card-modern {
            padding: 16px;
        }
    }

    /* Analysis Progress Styles */
    .analysis-progress {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
    }

    .progress-text {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .mini-progress {
        width: 60px;
        height: 4px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
    }

    .mini-progress-bar {
        height: 100%;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-radius: 4px;
        transition: width 0.5s ease;
        position: relative;
    }

    .mini-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        animation: miniShimmer 2s infinite;
    }

    @keyframes miniShimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .limits-content {
            flex-direction: column;
            gap: 12px;
        }

        .limit-item {
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-primary);
        }

        .limit-item:last-child {
            border-bottom: none;
        }

        .limit-label {
            margin-bottom: 0;
        }

        .limits-header {
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
        }

        .upgrade-btn {
            justify-content: center;
        }
        .hero-title {
            font-size: 1.8rem;
        }
        
        .upload-container {
            padding: 20px;
        }
        
        .upload-tabs {
            flex-direction: column;
        }
        
        .upload-area {
            padding: 30px 16px;
        }
        
        .file-types {
            flex-direction: column;
            align-items: center;
        }
        
        .features-grid {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .cta-buttons {
            flex-direction: column;
            align-items: center;
        }

        .btn-large {
            width: 100%;
            max-width: 300px;
        }

        .cta-section h3 {
            font-size: 1.4rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- –£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ª–∏–º–∏—Ç–∞—Ö -->
<div class="container-fluid px-3">
    {% include 'smart_limit_notifications.html' %}
</div>

<!-- Compact Hero -->
<section class="hero">
    <h1 class="hero-title">
        AI-–∫–æ–Ω—Å–ø–µ–∫—Ç <span class="text-gradient">Pro</span>
    </h1>
    <p class="hero-subtitle">
        –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ò–ò
    </p>
</section>

<!-- Main Upload Section -->
<section class="upload-section">
    <div class="upload-container">
        <!-- Upload Tabs -->
        <div class="upload-tabs">
            <button class="upload-tab active" onclick="switchTab('file')">
                <i class="fas fa-file-upload"></i>
                <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</span>
            </button>
            {% if user_subscription and user_subscription.limits.video_support %}
            <button class="upload-tab" onclick="switchTab('url')">
                <i class="fas fa-link"></i>
                <span>–í–∏–¥–µ–æ –ø–æ —Å—Å—ã–ª–∫–µ</span>
            </button>
            {% else %}
            <button class="upload-tab disabled" title="–î–æ—Å—Ç—É–ø–Ω–æ –≤ –ø–ª–∞–Ω–∞—Ö STARTER, BASIC –∏ PRO" style="opacity: 0.5; cursor: not-allowed;">
                <i class="fas fa-lock"></i>
                <span>–í–∏–¥–µ–æ –ø–æ —Å—Å—ã–ª–∫–µ üîí</span>
            </button>
            {% endif %}
        </div>
        
        <!-- Subscription Limits Info -->
        {% if current_user.is_authenticated and usage_stats %}
        <div class="subscription-limits-modern mb-4">
            <div class="limits-card-modern">
                <div class="limits-header-modern">
                    <div class="plan-info">
                        <div class="plan-badge-modern">
                            <i class="fas fa-crown"></i>
                            <span>–ü–ª–∞–Ω: {{ usage_stats.plan.upper() }}</span>
                        </div>
                    </div>
                    <button class="upgrade-btn-modern" onclick="window.location.href='{{ url_for('pricing') }}'">
                        <i class="fas fa-arrow-up"></i>
                        <span>–û–±–Ω–æ–≤–∏—Ç—å</span>
                    </button>
                </div>
                
                <div class="limits-grid">
                    <div class="limit-card analyses-card">
                        <div class="limit-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="limit-header">
                            <span class="limit-label">–ê–Ω–∞–ª–∏–∑—ã</span>
                        </div>
                        <div class="limit-content">
                            {% if usage_stats.analyses.unlimited %}
                                <div class="limit-value-large">{{ usage_stats.analyses.used }}</div>
                                <div class="limit-suffix">‚àû</div>
                            {% else %}
                                <div class="limit-value-large">{{ usage_stats.analyses.used }}/{{ usage_stats.analyses.limit }}</div>
                                <div class="progress-bar-modern">
                                    <div class="progress-fill" style="width: {{ (usage_stats.analyses.used / usage_stats.analyses.limit * 100) if usage_stats.analyses.limit > 0 else 0 }}%"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="limit-card pdf-card">
                        <div class="limit-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="limit-header">
                            <span class="limit-label">PDF —Å—Ç—Ä–∞–Ω–∏—Ü</span>
                        </div>
                        <div class="limit-content">
                            {% if usage_stats.pdf_pages.unlimited %}
                                <div class="limit-value-large">‚àû</div>
                            {% else %}
                                <div class="limit-value-large">–¥–æ {{ usage_stats.pdf_pages.limit }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="limit-card video-card {% if not (user_subscription and user_subscription.limits.video_support) %}disabled-card{% endif %}">
                        <div class="limit-icon">
                            {% if user_subscription and user_subscription.limits.video_support %}
                                <i class="fas fa-video"></i>
                            {% else %}
                                <i class="fas fa-lock"></i>
                            {% endif %}
                        </div>
                        <div class="limit-header">
                            <span class="limit-label">–í–∏–¥–µ–æ</span>
                        </div>
                        <div class="limit-content">
                            {% if user_subscription and user_subscription.limits.video_support %}
                                {% if usage_stats.video_minutes.unlimited %}
                                    <div class="limit-value-large">‚àû</div>
                                {% else %}
                                    <div class="limit-value-large">–¥–æ {{ usage_stats.video_minutes.limit }} –º–∏–Ω</div>
                                {% endif %}
                            {% else %}
                                <div class="limit-value-disabled">–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- File Upload -->
        <div id="file-upload" class="upload-content active">
            <form id="upload-form" action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data">
                <input type="file" name="file" id="file-input" accept="{% set accepted_formats = ['.pdf'] %}{% if user_subscription and user_subscription.limits.pptx_support %}{% set _ = accepted_formats.append('.pptx') %}{% endif %}{% if user_subscription and user_subscription.limits.video_support %}{% set _ = accepted_formats.extend(['.mp4', '.mov', '.mkv']) %}{% endif %}{{ accepted_formats | join(',') }}" style="display: none;" required>
                
                <div class="upload-area" id="upload-area">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <h3 class="upload-title">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h3>
                    <p class="upload-subtitle">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 500 –ú–ë</p>
                    
                    <div class="file-types">
                        <div class="file-type">
                            <i class="fas fa-file-pdf" style="color: #ef4444;"></i>
                            <span>PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã</span>
                        </div>
                        {% if user_subscription and user_subscription.limits.pptx_support %}
                        <div class="file-type">
                            <i class="fas fa-file-powerpoint" style="color: #d97706;"></i>
                            <span>PowerPoint (PPTX)</span>
                        </div>
                        {% else %}
                        <div class="file-type disabled" title="–î–æ—Å—Ç—É–ø–Ω–æ –≤ –ø–ª–∞–Ω–∞—Ö STARTER, BASIC –∏ PRO">
                            <i class="fas fa-file-powerpoint" style="color: #9ca3af;"></i>
                            <span style="color: #9ca3af;">PowerPoint (PPTX) üîí</span>
                        </div>
                        {% endif %}
                        {% if user_subscription and user_subscription.limits.video_support %}
                        <div class="file-type">
                            <i class="fas fa-video" style="color: #06b6d4;"></i>
                            <span>MP4, MOV, MKV</span>
                        </div>
                        {% else %}
                        <div class="file-type disabled" title="–î–æ—Å—Ç—É–ø–Ω–æ –≤ –ø–ª–∞–Ω–∞—Ö STARTER, BASIC –∏ PRO">
                            <i class="fas fa-video" style="color: #9ca3af;"></i>
                            <span style="color: #9ca3af;">MP4, MOV, MKV üîí</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-upload" style="margin-right: 8px;"></i>
                        –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                    </button>
                </div>
                
                <!-- File Selected -->
                <div id="file-selected" class="file-selected">
                    <i class="fas fa-file-check file-icon"></i>
                    <div id="file-name" class="file-name"></div>
                    <div id="file-size" class="file-size"></div>
                    
                    <!-- Page Selection -->
                    <div id="page-selection" class="page-selection">
                        <div class="page-selection-title">
                            <i class="fas fa-file-alt"></i>
                            <span>–í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</span>
                        </div>
                        <div class="page-info">
                            <h6>
                                <i class="fas fa-lightbulb"></i>
                                <span>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–∞–Ω–∏—Ü:</span>
                            </h6>
                            <ul class="page-recommendations">
                                <li class="page-recommendation-item">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-gem"></i>
                                    </div>
                                    <div class="recommendation-text">
                                        –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">5-10 —Å—Ç—Ä–∞–Ω–∏—Ü</span>
                                    </div>
                                </li>
                                <li class="page-recommendation-item">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="recommendation-text">
                                        –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">10-20 —Å—Ç—Ä–∞–Ω–∏—Ü</span>
                                    </div>
                                </li>
                                <li class="page-recommendation-item">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="recommendation-text">
                                        –°–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞: <span class="recommendation-pages">—Å–≤—ã—à–µ 20 —Å—Ç—Ä–∞–Ω–∏—Ü</span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <input type="text" class="page-input" id="page-range" name="page_range" 
                               placeholder="1-20, 50-100" value="1-20">
                        <div class="quick-buttons">
                            <button type="button" class="quick-btn" onclick="setPageRange('1-10')">–ü–µ—Ä–≤—ã–µ 10</button>
                            <button type="button" class="quick-btn" onclick="setPageRange('1-20')">–ü–µ—Ä–≤—ã–µ 20</button>
                            <button type="button" class="quick-btn" onclick="setPageRange('–≤—Å–µ')">–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</button>
                        </div>
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="upload-progress" class="upload-progress">
                        <div class="processing-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 class="processing-title">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</h3>
                        <p class="processing-subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
                        
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                            <div id="progress-text" class="progress-text">0%</div>
                        </div>
                        
                        <div class="upload-stats">
                            <span id="upload-speed" class="upload-speed">–°–∫–æ—Ä–æ—Å—Ç—å: --</span>
                            <span id="upload-eta" class="upload-eta">–û—Å—Ç–∞–ª–æ—Å—å: --</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            <i class="fas fa-rocket" style="margin-right: 8px;"></i>
                            –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑
                        </button>
                        <button type="button" class="btn btn-outline" onclick="resetUpload()">
                            <i class="fas fa-undo" style="margin-right: 8px;"></i>
                            –°–±—Ä–æ—Å–∏—Ç—å
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- URL Upload -->
        <div id="url-upload" class="upload-content">
            {% if user_subscription and user_subscription.limits.video_support %}
            <form id="url-form" action="{{ url_for('upload_video_url') }}" method="POST">
                <div style="text-align: center;">
                    <i class="fas fa-link upload-icon" style="color: var(--secondary);"></i>
                    <h3 class="upload-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ —Å—Å—ã–ª–∫–µ</h3>
                    <p class="upload-subtitle">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: YouTube, Vimeo, RuTube, VK, OK.ru</p>
                    
                    <input type="url" class="url-input" id="video-url" name="video_url" 
                           placeholder="https://www.youtube.com/watch?v=..." required>
                    
                    <div class="url-info">
                        <h6>
                            <i class="fas fa-info-circle"></i>
                            <span>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</span>
                        </h6>
                        <ul class="url-limitations">
                            <li class="url-limitation-item">
                                <div class="limitation-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="limitation-text">
                                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span class="limitation-value">2 —á–∞—Å–∞</span>
                                </div>
                            </li>
                            <li class="url-limitation-item">
                                <div class="limitation-icon">
                                    <i class="fas fa-video"></i>
                                </div>
                                <div class="limitation-text">
                                    –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–∫–∏: <span class="limitation-value">–¥–æ 720p</span>
                                </div>
                            </li>
                            <li class="url-limitation-item">
                                <div class="limitation-icon">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div class="limitation-text">
                                    –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: <span class="limitation-value">3-7 –º–∏–Ω—É—Ç</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <button type="submit" class="btn btn-secondary">
                        <i class="fas fa-download" style="margin-right: 8px;"></i>
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </div>
            </form>
            {% else %}
            <div style="text-align: center; padding: 40px 20px;">
                <i class="fas fa-lock upload-icon" style="color: #9ca3af;"></i>
                <h3 class="upload-title" style="color: #9ca3af;">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h3>
                <p class="upload-subtitle" style="color: #9ca3af;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –ø–ª–∞–Ω–∞—Ö STARTER, BASIC –∏ PRO
                </p>
                <a href="{{ url_for('pricing') }}" class="btn btn-primary" style="margin-top: 20px;">
                    <i class="fas fa-arrow-up" style="margin-right: 8px;"></i>
                    –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Compact Features -->
<section class="features-compact">
    <div class="text-center">
        <h2>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h2>
        <p class="text-secondary">–ú–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</p>
    </div>
    
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-sitemap"></i>
            </div>
            <h3 class="feature-title">–ò–µ—Ä–∞—Ä—Ö–∏—è —Ç–µ–º</h3>
            <p class="feature-description">
                –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∑–Ω–∞–Ω–∏–π —Å –ø–æ–¥—Ç–µ–º–∞–º–∏
            </p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-project-diagram"></i>
            </div>
            <h3 class="feature-title">Mind Map</h3>
            <p class="feature-description">
                –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã
            </p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-calendar-check"></i>
            </div>
            <h3 class="feature-title">–ü–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è</h3>
            <p class="feature-description">
                –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
            </p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <h3 class="feature-title">–£–º–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h3>
            <p class="feature-description">
                5 —Ç–∏–ø–æ–≤ —Ñ–ª–µ—à-–∫–∞—Ä—Ç —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º SuperMemo
            </p>
        </div>
    </div>
    
    <!-- Social Proof Section -->
    <div class="social-proof-section">
        <h3>–ë–æ–ª–µ–µ 10,000 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —É–∂–µ —É–ª—É—á—à–∏–ª–∏ —Å–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">95%</div>
                <div class="stat-label">—É–ª—É—á—à–µ–Ω–∏–µ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">3x</div>
                <div class="stat-label">–±—ã—Å—Ç—Ä–µ–µ –∏–∑—É—á–µ–Ω–∏–µ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">5+</div>
                <div class="stat-label">–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤</div>
            </div>
        </div>
    </div>
    
    <!-- CTA Section -->
    <div class="cta-section">
        {% if current_user.is_authenticated %}
            <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ current_user.username }}!</h3>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤—ã—à–µ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏</p>
            <div class="cta-buttons">
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary btn-large">
                    <i class="fas fa-tachometer-alt" style="margin-right: 8px;"></i>
                    –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                </a>
                <a href="{{ url_for('profile') }}" class="btn btn-outline btn-large">
                    <i class="fas fa-user-cog" style="margin-right: 8px;"></i>
                    –ü—Ä–æ—Ñ–∏–ª—å
                </a>
            </div>
        {% else %}
            <h3>–ì–æ—Ç–æ–≤—ã —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ?</h3>
            <p>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ò–ò-–∞–Ω–∞–ª–∏–∑–∞</p>
            <div class="cta-buttons">
                <a href="{{ url_for('register') }}" class="btn btn-primary btn-large">
                    <i class="fas fa-user-plus" style="margin-right: 8px;"></i>
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </a>
                <a href="{{ url_for('login') }}" class="btn btn-outline btn-large">
                    <i class="fas fa-sign-in-alt" style="margin-right: 8px;"></i>
                    –í–æ–π—Ç–∏
                </a>
            </div>
        {% endif %}
    </div>
</section>

<!-- Processing Modal -->
<div id="processing-modal" class="modal">
    <div class="modal-content">
        <div class="processing-icon">
            <i class="fas fa-brain"></i>
        </div>
        <h2 class="processing-title">–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é –ò–ò</h2>
        <p class="processing-subtitle">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à –º–∞—Ç–µ—Ä–∏–∞–ª –∏ —Å–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è</p>
        
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        
        <p class="text-secondary" style="font-size: 0.8rem; margin-bottom: 20px;">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 2-5 –º–∏–Ω—É—Ç</p>
        
        <button type="button" class="btn btn-outline" onclick="cancelAnalysis()" style="margin-top: 10px;">
            <i class="fas fa-times" style="margin-right: 8px;"></i>
            –û—Ç–º–µ–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
        </button>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Tab switching
    function switchTab(tab) {
        document.querySelectorAll('.upload-tab').forEach(btn => btn.classList.remove('active'));
        event.target.closest('.upload-tab').classList.add('active');
        
        document.querySelectorAll('.upload-content').forEach(content => content.classList.remove('active'));
        document.getElementById(tab + '-upload').classList.add('active');
    }

    // File upload handling
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    const fileSelected = document.getElementById('file-selected');
    const pageSelection = document.getElementById('page-selection');

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect();
        }
    });

    uploadArea.addEventListener('click', (e) => {
        if (e.target.tagName !== 'BUTTON' && !e.target.closest('button')) {
            fileInput.click();
        }
    });

    fileInput.addEventListener('change', handleFileSelect);

    function handleFileSelect() {
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const fileName = file.name;
            const fileSize = (file.size / (1024 * 1024)).toFixed(2);
            const fileExtension = fileName.split('.').pop().toLowerCase();
            
            document.getElementById('file-name').textContent = fileName;
            document.getElementById('file-size').textContent = `–†–∞–∑–º–µ—Ä: ${fileSize} –ú–ë`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü/—Å–ª–∞–π–¥–æ–≤ –¥–ª—è PDF –∏ PPTX —Ñ–∞–π–ª–æ–≤
            if (fileExtension === 'pdf' || fileExtension === 'pptx') {
                pageSelection.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                const selectionTitle = document.querySelector('.page-selection-title span');
                const pageInput = document.getElementById('page-range');
                
                if (fileExtension === 'pptx') {
                    selectionTitle.textContent = '–í—ã–±–æ—Ä —Å–ª–∞–π–¥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
                    pageInput.placeholder = '1-20, 50-100 (–Ω–æ–º–µ—Ä–∞ —Å–ª–∞–π–¥–æ–≤)';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è PowerPoint
                    const recommendations = document.querySelectorAll('.recommendation-text');
                    recommendations[0].innerHTML = '–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">5-10 —Å–ª–∞–π–¥–æ–≤</span>';
                    recommendations[1].innerHTML = '–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">10-20 —Å–ª–∞–π–¥–æ–≤</span>';
                    recommendations[2].innerHTML = '–°–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞: <span class="recommendation-pages">—Å–≤—ã—à–µ 20 —Å–ª–∞–π–¥–æ–≤</span>';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
                    const quickButtons = document.querySelectorAll('.quick-btn');
                    quickButtons[0].textContent = '–ü–µ—Ä–≤—ã–µ 10';
                    quickButtons[0].setAttribute('onclick', "setPageRange('1-10')");
                    quickButtons[1].textContent = '–ü–µ—Ä–≤—ã–µ 20';
                    quickButtons[1].setAttribute('onclick', "setPageRange('1-20')");
                    quickButtons[2].textContent = '–í—Å–µ —Å–ª–∞–π–¥—ã';
                    quickButtons[2].setAttribute('onclick', "setPageRange('–≤—Å–µ')");
                } else {
                    selectionTitle.textContent = '–í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞';
                    pageInput.placeholder = '1-20, 50-100';
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è PDF
                    const recommendations = document.querySelectorAll('.recommendation-text');
                    recommendations[0].innerHTML = '–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">5-10 —Å—Ç—Ä–∞–Ω–∏—Ü</span>';
                    recommendations[1].innerHTML = '–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ: <span class="recommendation-pages">10-20 —Å—Ç—Ä–∞–Ω–∏—Ü</span>';
                    recommendations[2].innerHTML = '–°–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞: <span class="recommendation-pages">—Å–≤—ã—à–µ 20 —Å—Ç—Ä–∞–Ω–∏—Ü</span>';
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
                    const quickButtons = document.querySelectorAll('.quick-btn');
                    quickButtons[0].textContent = '–ü–µ—Ä–≤—ã–µ 10';
                    quickButtons[0].setAttribute('onclick', "setPageRange('1-10')");
                    quickButtons[1].textContent = '–ü–µ—Ä–≤—ã–µ 20';
                    quickButtons[1].setAttribute('onclick', "setPageRange('1-20')");
                    quickButtons[2].textContent = '–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã';
                    quickButtons[2].setAttribute('onclick', "setPageRange('–≤—Å–µ')");
                }
            } else {
                pageSelection.style.display = 'none';
            }
            
            uploadArea.style.display = 'none';
            fileSelected.style.display = 'block';
            
            // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ –∞–Ω–∞–ª–∏–∑–∞
            setTimeout(() => {
                fileSelected.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 100);
        }
    }

    function setPageRange(range) {
        document.getElementById('page-range').value = range;
        document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
    }

    function resetUpload() {
        // –û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É –µ—Å–ª–∏ –æ–Ω–∞ –∏–¥–µ—Ç
        if (currentUploadXHR) {
            currentUploadXHR.abort();
            currentUploadXHR = null;
        }
        
        // –û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–Ω–∞–ª–∏–∑ –µ—Å–ª–∏ –æ–Ω –∏–¥–µ—Ç
        if (currentTaskId) {
            cancelAnalysis();
        }
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        if (analysisStatusInterval) {
            clearInterval(analysisStatusInterval);
            analysisStatusInterval = null;
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
        fileInput.value = '';
        uploadArea.style.display = 'block';
        fileSelected.style.display = 'none';
        pageSelection.style.display = 'none';
        
        // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        resetToInitialState();
    }

    function resetUpload() {
        fileInput.value = '';
        uploadArea.style.display = 'block';
        fileSelected.style.display = 'none';
        pageSelection.style.display = 'none';
    }

    // Analysis tracking
    let uploadStartTime = 0;
    let uploadedBytes = 0;
    let currentUploadXHR = null; // –î–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏
    let currentTaskId = null; // –î–ª—è –æ—Ç–º–µ–Ω—ã –∞–Ω–∞–ª–∏–∑–∞
    let analysisStatusInterval = null; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–Ω–∞–ª–∏–∑–∞

    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function formatTime(seconds) {
        if (seconds < 60) return Math.round(seconds) + ' —Å–µ–∫';
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.round(seconds % 60);
        return minutes + ' –º–∏–Ω ' + remainingSeconds + ' —Å–µ–∫';
    }

    function uploadFileWithProgress(formData) {
        console.log('üì§ uploadFileWithProgress –∑–∞–ø—É—â–µ–Ω–∞');
        
        const xhr = new XMLHttpRequest();
        currentUploadXHR = xhr;
        console.log('üîó currentUploadXHR —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', !!currentUploadXHR);
        
        const uploadProgress = document.getElementById('upload-progress');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const uploadSpeed = document.getElementById('upload-speed');
        const uploadEta = document.getElementById('upload-eta');
        const submitBtn = document.getElementById('submit-btn');
        
        // Show progress bar
        uploadProgress.classList.add('active');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>–ó–∞–≥—Ä—É–∑–∫–∞...';
        
        // ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–∞–∑—É –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        const modal = document.getElementById('processing-modal');
        modal.classList.add('active');
        console.log('üîÑ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏');
        
        uploadStartTime = Date.now();
        
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                const percentComplete = Math.round((e.loaded / e.total) * 100);
                const currentTime = Date.now();
                const elapsedTime = (currentTime - uploadStartTime) / 1000;
                
                progressFill.style.width = percentComplete + '%';
                progressText.textContent = percentComplete + '%';
                
                const speed = e.loaded / elapsedTime;
                uploadSpeed.textContent = '–°–∫–æ—Ä–æ—Å—Ç—å: ' + formatBytes(speed) + '/—Å';
                
                if (speed > 0) {
                    const remainingBytes = e.total - e.loaded;
                    const eta = remainingBytes / speed;
                    uploadEta.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: ' + formatTime(eta);
                }
                
                uploadedBytes = e.loaded;
            }
        });
        
        xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
                try {
                    const response = JSON.parse(xhr.responseText);
                    if (response.success && response.task_id) {
                        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
                        currentTaskId = response.task_id;
                        currentUploadXHR = null;
                        
                        progressFill.style.width = '100%';
                        progressText.textContent = '100%';
                        uploadSpeed.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
                        uploadEta.textContent = '–ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∞–ª–∏–∑...';
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –∞–Ω–∞–ª–∏–∑–∞
                        setTimeout(() => {
                            uploadProgress.classList.remove('active');
                            startAnalysisTracking(response.task_id);
                        }, 1000);
                    } else {
                        handleUploadError('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + (response.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                    }
                } catch (e) {
                    handleUploadError('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } else {
                handleUploadError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            }
        });
        
        xhr.addEventListener('error', () => {
            handleUploadError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
        });
        
        xhr.addEventListener('timeout', () => {
            handleUploadError('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.');
        });
        
        xhr.addEventListener('abort', () => {
            const uploadProgress = document.getElementById('upload-progress');
            const submitBtn = document.getElementById('submit-btn');
            
            uploadProgress.classList.remove('active');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-rocket" style="margin-right: 8px;"></i>–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑';
            
            currentUploadXHR = null;
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
        });
        
        xhr.timeout = 600000;
        xhr.open('POST', document.getElementById('upload-form').action);
        xhr.send(formData);
    }
    
    function startAnalysisTracking(taskId) {
        console.log('üéØ startAnalysisTracking –≤—ã–∑–≤–∞–Ω–∞ —Å taskId:', taskId);
        
        currentTaskId = taskId; // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ currentTaskId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
        
        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        if (typeof localStorage !== 'undefined') {
            localStorage.setItem('currentTaskId', taskId);
            console.log('üíæ currentTaskId —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage:', taskId);
        }
        
        console.log('üìù currentTaskId —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤:', currentTaskId);
        
        const modal = document.getElementById('processing-modal');
        const modalTitle = modal.querySelector('.processing-title');
        const modalSubtitle = modal.querySelector('.processing-subtitle');
        
        modal.classList.add('active');
        modalTitle.textContent = '–ê–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é –ò–ò';
        modalSubtitle.textContent = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à –º–∞—Ç–µ—Ä–∏–∞–ª...';
        
        console.log('üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        analysisStatusInterval = setInterval(() => {
            checkAnalysisStatus(taskId);
        }, 2000);
        
        // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–∑—É
        checkAnalysisStatus(taskId);
    }
    
    function checkAnalysisStatus(taskId) {
        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:', taskId);
        
        fetch(`/api/analysis/status/${taskId}`)
            .then(response => {
                console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('üìä –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å–∞:', data);
                
                if (data.success) {
                    const task = data.task;
                    console.log('üìã –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏:', task.status);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    updateAnalysisProgress(task);
                    
                    if (task.status === 'completed') {
                        console.log('‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                        clearInterval(analysisStatusInterval);
                        analysisStatusInterval = null;
                        currentTaskId = null;
                        
                        if (task.access_token) {
                            console.log('üîó –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', task.access_token);
                            window.location.href = `/result/${task.access_token}`;
                        } else {
                            console.error('‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–æ access_token –Ω–µ –Ω–∞–π–¥–µ–Ω');
                            alert('–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                            resetToInitialState();
                        }
                    } else if (task.status === 'cancelled') {
                        console.log('üö´ –ê–Ω–∞–ª–∏–∑ –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω');
                        clearInterval(analysisStatusInterval);
                        analysisStatusInterval = null;
                        currentTaskId = null;
                        resetToInitialState();
                    } else if (task.status === 'failed') {
                        console.error('üí• –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π');
                        clearInterval(analysisStatusInterval);
                        analysisStatusInterval = null;
                        currentTaskId = null;
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ñ–∞–π–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                        resetToInitialState();
                    } else if (task.status === 'processing') {
                        console.log('‚è≥ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...', `${task.progress || 0}%`);
                    }
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', data.error);
                }
            })
            .catch(error => {
                console.error('üö® –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å—Ç–∞—Ç—É—Å–∞:', error);
            });
    }
    
    function updateAnalysisProgress(task) {
        const modal = document.getElementById('processing-modal');
        if (!modal.classList.contains('active')) return;
        
        const progressBar = modal.querySelector('.progress-fill');
        const modalTitle = modal.querySelector('.processing-title');
        const modalSubtitle = modal.querySelector('.processing-subtitle');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        const progress = task.progress || 0;
        if (progressBar) {
            progressBar.style.width = progress + '%';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —ç—Ç–∞–ø–∞
        const currentStage = task.current_stage || '–ê–Ω–∞–ª–∏–∑ —Å –ø–æ–º–æ—â—å—é –ò–ò';
        const stageDetails = task.stage_details || '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à –º–∞—Ç–µ—Ä–∏–∞–ª...';
        
        if (modalTitle) {
            modalTitle.textContent = currentStage;
        }
        
        if (modalSubtitle) {
            modalSubtitle.textContent = `${stageDetails} (${progress}%)`;
        }
        
        console.log(`üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${progress}% - ${currentStage}`);
    }
    
    function cancelAnalysis() {
        console.log('üî¥ cancelAnalysis –≤—ã–∑–≤–∞–Ω–∞');
        console.log('üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ: currentTaskId =', currentTaskId, ', currentUploadXHR =', !!currentUploadXHR);
        console.log('üìä –¢–∏–ø—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: currentTaskId type =', typeof currentTaskId, ', currentUploadXHR type =', typeof currentUploadXHR);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        console.log('üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:');
        console.log('   window.currentTaskId =', window.currentTaskId);
        console.log('   analysisStatusInterval =', !!analysisStatusInterval);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage –∏ sessionStorage
        if (typeof localStorage !== 'undefined') {
            console.log('   localStorage.currentTaskId =', localStorage.getItem('currentTaskId'));
        }
        if (typeof sessionStorage !== 'undefined') {
            console.log('   sessionStorage.currentTaskId =', sessionStorage.getItem('currentTaskId'));
        }
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
        const modal = document.getElementById('processing-modal');
        const uploadProgress = document.getElementById('upload-progress');
        console.log('üîç –°–æ—Å—Ç–æ—è–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:');
        console.log('   - Modal active:', modal ? modal.classList.contains('active') : 'modal not found');
        console.log('   - Upload progress active:', uploadProgress ? uploadProgress.classList.contains('active') : 'progress not found');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–¥–µ—Ç –ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        if (currentUploadXHR) {
            console.log('üì§ –û—Ç–º–µ–Ω—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞...');
            console.log('üì§ currentUploadXHR –ø–µ—Ä–µ–¥ –æ—Ç–º–µ–Ω–æ–π:', currentUploadXHR);
            
            try {
                currentUploadXHR.abort();
                console.log('‚úÖ XMLHttpRequest.abort() –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            } catch (e) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ abort():', e);
            }
            
            currentUploadXHR = null;
            console.log('üîÑ currentUploadXHR —Å–±—Ä–æ—à–µ–Ω –≤ null');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            const uploadProgress = document.getElementById('upload-progress');
            const submitBtn = document.getElementById('submit-btn');
            
            if (uploadProgress) {
                uploadProgress.classList.remove('active');
                console.log('üìä –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å–∫—Ä—ã—Ç');
            }
            
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-rocket" style="margin-right: 8px;"></i>–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑';
                console.log('üîò –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            }
            
            console.log('‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
            resetToInitialState();
            return;
        }
        
        // –ï—Å–ª–∏ currentTaskId –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ localStorage
        if (!currentTaskId && typeof localStorage !== 'undefined') {
            const savedTaskId = localStorage.getItem('currentTaskId');
            if (savedTaskId) {
                currentTaskId = parseInt(savedTaskId);
                console.log('üîÑ currentTaskId –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ localStorage:', currentTaskId);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–¥–µ—Ç –ª–∏ –∞–Ω–∞–ª–∏–∑
        if (currentTaskId) {
            console.log('üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –æ—Ç–º–µ–Ω—ã –¥–ª—è –∑–∞–¥–∞—á–∏:', currentTaskId);
            
            fetch(`/api/analysis/cancel/${currentTaskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                console.log('üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('üìã –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                
                if (data.success) {
                    console.log('‚úÖ –ê–Ω–∞–ª–∏–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω');
                    if (analysisStatusInterval) {
                        clearInterval(analysisStatusInterval);
                        analysisStatusInterval = null;
                        console.log('‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞');
                    }
                    currentTaskId = null;
                    resetToInitialState();
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∞–Ω–∞–ª–∏–∑–∞:', data.error);
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∞–Ω–∞–ª–∏–∑–∞: ' + data.error);
                }
            })
            .catch(error => {
                console.error('üö® –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç–º–µ–Ω—ã:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∞–Ω–∞–ª–∏–∑–∞');
            });
        } else {
            console.warn('‚ö†Ô∏è currentTaskId –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É...');
            
            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ API
            fetch('/api/analysis/active-tasks')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.tasks && data.tasks.length > 0) {
                        const activeTask = data.tasks[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É
                        console.log('üîç –ù–∞–π–¥–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞:', activeTask.id);
                        
                        // –û—Ç–º–µ–Ω—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É
                        fetch(`/api/analysis/cancel/${activeTask.id}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        })
                        .then(response => response.json())
                        .then(cancelData => {
                            if (cancelData.success) {
                                console.log('‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
                                alert('–ê–Ω–∞–ª–∏–∑ –æ—Ç–º–µ–Ω–µ–Ω');
                                resetToInitialState();
                            } else {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏:', cancelData.error);
                                alert('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã: ' + cancelData.error);
                            }
                        })
                        .catch(error => {
                            console.error('üö® –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç–º–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏:', error);
                            alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ');
                        });
                    } else {
                        console.warn('‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                        alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã');
                    }
                })
                .catch(error => {
                    console.error('üö® –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á:', error);
                    alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã');
                });
        }
    }
    
    function resetToInitialState() {
        console.log('üîÑ resetToInitialState –≤—ã–∑–≤–∞–Ω–∞');
        
        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        if (currentUploadXHR) {
            console.log('üîÑ –°–±—Ä–∞—Å—ã–≤–∞–µ–º currentUploadXHR');
            currentUploadXHR = null;
        }
        
        if (currentTaskId) {
            console.log('üîÑ –°–±—Ä–∞—Å—ã–≤–∞–µ–º currentTaskId');
            currentTaskId = null;
        }
        
        if (analysisStatusInterval) {
            console.log('üîÑ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º analysisStatusInterval');
            clearInterval(analysisStatusInterval);
            analysisStatusInterval = null;
        }
        
        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—á–∏—â–∞–µ–º localStorage
        if (typeof localStorage !== 'undefined') {
            localStorage.removeItem('currentTaskId');
            console.log('üóëÔ∏è currentTaskId —É–¥–∞–ª–µ–Ω –∏–∑ localStorage');
        }
        
        // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = document.getElementById('processing-modal');
        if (modal) {
            modal.classList.remove('active');
            console.log('üîÑ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–∫—Ä—ã—Ç–æ');
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
        const uploadProgress = document.getElementById('upload-progress');
        const submitBtn = document.getElementById('submit-btn');
        
        if (uploadProgress) {
            uploadProgress.classList.remove('active');
            console.log('üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä—ã—Ç');
        }
        
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-rocket" style="margin-right: 8px;"></i>–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑';
            console.log('üîÑ –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const uploadSpeed = document.getElementById('upload-speed');
        const uploadEta = document.getElementById('upload-eta');
        
        if (progressFill) progressFill.style.width = '0%';
        if (progressText) progressText.textContent = '0%';
        if (uploadSpeed) uploadSpeed.textContent = '–°–∫–æ—Ä–æ—Å—Ç—å: --';
        if (uploadEta) uploadEta.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: --';
        
        console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–æ');
        console.log('üìä –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: currentTaskId =', currentTaskId, ', currentUploadXHR =', !!currentUploadXHR);
    }
    
    function handleUploadError(message) {
        const uploadProgress = document.getElementById('upload-progress');
        const submitBtn = document.getElementById('submit-btn');
        
        uploadProgress.classList.remove('active');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-rocket" style="margin-right: 8px;"></i>–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑';
        
        currentUploadXHR = null;
        alert(message);
    }

    // Form submissions
    document.getElementById('upload-form').addEventListener('submit', (e) => {
        e.preventDefault(); // Always prevent default form submission
        
        if (fileInput.files.length === 0) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
            return;
        }
        
        // Create FormData object
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        
        // Add page range if applicable
        const pageRange = document.getElementById('page-range').value;
        if (pageRange) {
            formData.append('page_range', pageRange);
        }
        
        // Start upload with progress tracking
        uploadFileWithProgress(formData);
    });

    document.getElementById('url-form').addEventListener('submit', (e) => {
        e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
        
        const videoUrl = document.getElementById('video-url').value.trim();
        if (!videoUrl) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ');
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        showProcessingModal();
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
        const formData = new FormData();
        formData.append('video_url', videoUrl);
        
        fetch('/upload_url', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.task_id) {
                // –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
                currentTaskId = data.task_id;
                startAnalysisTracking(data.task_id);
            } else {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                resetToInitialState();
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', error);
            alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–∏–¥–µ–æ');
            resetToInitialState();
        });
    });

    function showProcessingModal() {
        document.getElementById('processing-modal').classList.add('active');
    }
</script>
{% endblock %}