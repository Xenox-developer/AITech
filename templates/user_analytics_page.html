{% extends "base.html" %}

{% block title %}–ú–æ—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ - AI Study{% endblock %}

{% block extra_styles %}
<style>
    :root {
        --primary: #6366f1;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #06b6d4;
        --secondary: #6b7280;
    }

    .analytics-header {
        background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 20px 20px;
    }

    .plan-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        margin-left: 1rem;
    }

    .plan-freemium { background: rgba(107, 114, 128, 0.2); }
    .plan-lite { background: rgba(6, 182, 212, 0.2); }
    .plan-starter { background: rgba(107, 114, 128, 0.2); }
    .plan-basic { background: rgba(245, 158, 11, 0.2); }
    .plan-pro { background: rgba(16, 185, 129, 0.2); }

    .analytics-card {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        transition: transform 0.3s ease;
    }

    .analytics-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .stat-item {
        text-align: center;
        padding: 1.5rem;
        background: rgba(99, 102, 241, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(99, 102, 241, 0.1);
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 900;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: var(--secondary);
        font-weight: 500;
    }

    .progress-item {
        margin-bottom: 1.5rem;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .progress-bar-container {
        background: #f3f4f6;
        border-radius: 10px;
        height: 8px;
        overflow: hidden;
    }

    .progress-bar {
        height: 100%;
        border-radius: 10px;
        transition: width 0.8s ease;
    }

    .progress-success { background: var(--success); }
    .progress-warning { background: var(--warning); }
    .progress-info { background: var(--info); }

    .recommendations-list {
        list-style: none;
        padding: 0;
    }

    .recommendation-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: rgba(16, 185, 129, 0.05);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        border-left: 4px solid var(--success);
    }

    .recommendation-icon {
        width: 40px;
        height: 40px;
        background: var(--success);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        margin-right: 1rem;
        flex-shrink: 0;
    }

    .weak-areas-list {
        list-style: none;
        padding: 0;
    }

    .weak-area-item {
        display: flex;
        align-items: center;
        justify-content: between;
        padding: 1rem;
        background: rgba(239, 68, 68, 0.05);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        border-left: 4px solid var(--danger);
    }

    .weak-area-info {
        flex: 1;
    }

    .weak-area-accuracy {
        background: var(--danger);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .comparison-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: rgba(6, 182, 212, 0.05);
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }

    .comparison-value {
        font-weight: 700;
        font-size: 1.1rem;
    }

    .comparison-positive { color: var(--success); }
    .comparison-negative { color: var(--danger); }

    .upgrade-prompt {
        text-align: center;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border-radius: 16px;
        border: 2px dashed rgba(99, 102, 241, 0.3);
    }

    .upgrade-icon {
        font-size: 4rem;
        color: var(--primary);
        margin-bottom: 1rem;
    }

    .chart-container {
        height: 300px;
        margin: 2rem 0;
        background: #f9fafb;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--secondary);
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .analytics-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="analytics-header">
        <div class="container">
            <h1 class="mb-2">
                üìä –ú–æ—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                <span class="plan-badge plan-{{ plan_type }}">{{ plan_type.upper() }}</span>
            </h1>
            <p class="mb-0 opacity-75">
                {% if plan_type == 'freemium' %}
                    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞—á–∏–Ω–∞—è —Å –ø–ª–∞–Ω–∞ LITE
                {% elif plan_type == 'lite' %}
                    –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è
                {% elif plan_type == 'starter' %}
                    –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                {% elif plan_type == 'basic' %}
                    –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å —Å—Ä–∞–≤–Ω–µ–Ω–∏—è–º–∏
                {% elif plan_type == 'pro' %}
                    –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏
                {% endif %}
            </p>
        </div>
    </div>

    <div class="container">
        {% if plan_type == 'freemium' %}
            <!-- FREEMIUM - –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
            <div class="upgrade-prompt">
                <div class="upgrade-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3 class="mb-3">–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏!</h3>
                <p class="mb-4">–ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–≤–æ–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å.</p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card border-info">
                                    <div class="card-body text-center">
                                        <h5 class="text-info">LITE - ‚ÇΩ79/–Ω–µ–¥–µ–ª—è</h5>
                                        <p class="small">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑—É—á–µ–Ω–∏—è</p>
                                        <ul class="list-unstyled small text-start">
                                            <li>üìà –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</li>
                                            <li>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤</li>
                                            <li>‚è±Ô∏è –í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card border-warning">
                                    <div class="card-body text-center">
                                        <h5 class="text-warning">STARTER - ‚ÇΩ149/–Ω–µ–¥–µ–ª—è</h5>
                                        <p class="small">–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</p>
                                        <ul class="list-unstyled small text-start">
                                            <li>üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
                                            <li>üìö –ê–Ω–∞–ª–∏–∑ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç</li>
                                            <li>üèÜ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="{{ url_for('pricing') }}" class="btn btn-primary btn-lg">
                    <i class="fas fa-arrow-up me-2"></i>–í—ã–±—Ä–∞—Ç—å –ø–ª–∞–Ω
                </a>
            </div>

        {% elif analytics_data %}
            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞–Ω–∞ -->
            
            {% if analytics_data.type == 'learning_stats' %}
                <!-- LITE - –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="analytics-card">
                    <h3 class="mb-4"><i class="fas fa-chart-bar text-info me-2"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑—É—á–µ–Ω–∏—è</h3>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.total_documents }}</div>
                            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.active_days }}</div>
                            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.estimated_study_time }}</div>
                            <div class="stat-label">–ú–∏–Ω—É—Ç –∏–∑—É—á–µ–Ω–∏—è</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.file_types.pdf + analytics_data.file_types.video + analytics_data.file_types.pptx }}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</div>
                        </div>
                    </div>

                    <h4 class="mb-3">–¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="progress-item">
                                <div class="progress-label">
                                    <span>üìÑ PDF —Ñ–∞–π–ª—ã</span>
                                    <span>{{ analytics_data.file_types.pdf }}</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar progress-info" style="width: {{ (analytics_data.file_types.pdf / (analytics_data.total_documents or 1) * 100) }}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-item">
                                <div class="progress-label">
                                    <span>üé¨ –í–∏–¥–µ–æ</span>
                                    <span>{{ analytics_data.file_types.video }}</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar progress-warning" style="width: {{ (analytics_data.file_types.video / (analytics_data.total_documents or 1) * 100) }}%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="progress-item">
                                <div class="progress-label">
                                    <span>üìä PPTX</span>
                                    <span>{{ analytics_data.file_types.pptx }}</span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar progress-success" style="width: {{ (analytics_data.file_types.pptx / (analytics_data.total_documents or 1) * 100) }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            {% elif analytics_data.type == 'learning_progress' %}
                <!-- STARTER - –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è -->
                <div class="analytics-card">
                    <h3 class="mb-4"><i class="fas fa-graduation-cap text-warning me-2"></i>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</h3>
                    
                    <!-- –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.total_documents }}</div>
                            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.flashcard_progress.mastered_cards }}</div>
                            <div class="stat-label">–ö–∞—Ä—Ç–æ—á–µ–∫ –æ—Å–≤–æ–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.flashcard_progress.mastery_rate }}%</div>
                            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.chat_activity.total_messages }}</div>
                            <div class="stat-label">AI —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                        </div>
                    </div>

                    <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
                    {% if analytics_data.recommendations %}
                    <h4 class="mb-3">üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h4>
                    <ul class="recommendations-list">
                        {% for recommendation in analytics_data.recommendations %}
                        <li class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div>{{ recommendation }}</div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}

                    <!-- –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ -->
                    {% if analytics_data.weak_areas %}
                    <h4 class="mb-3 mt-4">üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</h4>
                    <ul class="weak-areas-list">
                        {% for area in analytics_data.weak_areas %}
                        <li class="weak-area-item">
                            <div class="weak-area-info">
                                <strong>{{ area.filename }}</strong>
                                <div class="text-muted small">{{ area.file_type.upper() }} ‚Ä¢ {{ area.reviews }} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                            </div>
                            <div class="weak-area-accuracy">{{ area.accuracy }}/3</div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>

            {% elif analytics_data.type == 'detailed_analytics' %}
                <!-- BASIC - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
                <div class="analytics-card">
                    <h3 class="mb-4"><i class="fas fa-chart-line text-success me-2"></i>–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                    
                    <!-- –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ + —Å—Ä–∞–≤–Ω–µ–Ω–∏—è -->
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.total_documents }}</div>
                            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.flashcard_progress.mastery_rate }}%</div>
                            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.comparison.performance_percentile }}%</div>
                            <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.optimal_study_hours|length }}</div>
                            <div class="stat-label">–û–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö —á–∞—Å–æ–≤</div>
                        </div>
                    </div>

                    <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                    <h4 class="mb-3">üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="comparison-item">
                                <span>–ê–Ω–∞–ª–∏–∑—ã vs —Å—Ä–µ–¥–Ω–µ–≥–æ</span>
                                <span class="comparison-value {{ 'comparison-positive' if analytics_data.comparison.analyses_vs_average > 0 else 'comparison-negative' }}">
                                    {{ "+" if analytics_data.comparison.analyses_vs_average > 0 else "" }}{{ analytics_data.comparison.analyses_vs_average }}%
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="comparison-item">
                                <span>AI —á–∞—Ç vs —Å—Ä–µ–¥–Ω–µ–≥–æ</span>
                                <span class="comparison-value {{ 'comparison-positive' if analytics_data.comparison.chat_vs_average > 0 else 'comparison-negative' }}">
                                    {{ "+" if analytics_data.comparison.chat_vs_average > 0 else "" }}{{ analytics_data.comparison.chat_vs_average }}%
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —á–∞—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è -->
                    {% if analytics_data.optimal_study_hours %}
                    <h4 class="mb-3 mt-4">‚è∞ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</h4>
                    <div class="row">
                        {% for hour_data in analytics_data.optimal_study_hours %}
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-primary">{{ hour_data.hour }}</div>
                                <div class="small text-muted">–¢–æ—á–Ω–æ—Å—Ç—å: {{ hour_data.accuracy }}/3</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- –ü—Ä–æ–≥–Ω–æ–∑—ã -->
                    {% if analytics_data.predictions %}
                    <h4 class="mb-3 mt-4">üîÆ –ü—Ä–æ–≥–Ω–æ–∑—ã</h4>
                    <div class="alert alert-info">
                        <strong>–°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è:</strong> {{ analytics_data.predictions.next_week_performance }}<br>
                        <strong>–¢—Ä–µ–Ω–¥:</strong> {{ analytics_data.predictions.improvement_trend }}<br>
                        <strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–æ–∫—É—Å:</strong> {{ analytics_data.predictions.recommended_focus }}
                    </div>
                    {% endif %}
                </div>

            {% elif analytics_data.type == 'full_analytics' %}
                <!-- PRO - –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
                <div class="analytics-card">
                    <h3 class="mb-4"><i class="fas fa-crown text-warning me-2"></i>–ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ PRO</h3>
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.total_documents }}</div>
                            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.learning_velocity.documents_per_week }}</div>
                            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.retention_forecast.retention_rate_7_days }}%</div>
                            <div class="stat-label">–£–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">{{ analytics_data.monthly_trends|length }}</div>
                            <div class="stat-label">–ú–µ—Å—è—Ü–µ–≤ –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>

                    <!-- –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è -->
                    <h4 class="mb-3 mt-4">üöÄ –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded mb-3">
                                <div class="h5 text-primary">{{ analytics_data.learning_velocity.velocity_trend }}</div>
                                <div class="small text-muted">–¢—Ä–µ–Ω–¥ —Å–∫–æ—Ä–æ—Å—Ç–∏</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded mb-3">
                                <div class="h5 text-info">{{ analytics_data.learning_velocity.learning_consistency }}</div>
                                <div class="small text-muted">–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded mb-3">
                                <div class="h5 text-success">{{ analytics_data.learning_velocity.mastery_improvement_rate }}%</div>
                                <div class="small text-muted">–£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded mb-3">
                                <div class="h5 text-warning">{{ analytics_data.learning_velocity.cards_per_week }}</div>
                                <div class="small text-muted">–ö–∞—Ä—Ç–æ—á–µ–∫ –≤ –Ω–µ–¥–µ–ª—é</div>
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–≥–Ω–æ–∑ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∑–Ω–∞–Ω–∏–π -->
                    <h4 class="mb-3">üß† –ü—Ä–æ–≥–Ω–æ–∑ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∑–Ω–∞–Ω–∏–π</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-chart-line me-2"></i>–ö—Ä–∏–≤–∞—è –∑–∞–±—ã–≤–∞–Ω–∏—è: {{ analytics_data.retention_forecast.forgetting_curve }}</h6>
                                <p class="mb-2">–£–¥–µ—Ä–∂–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π: <strong>{{ analytics_data.retention_forecast.retention_rate_7_days }}%</strong></p>
                                <p class="mb-2">–£–¥–µ—Ä–∂–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π: <strong>{{ analytics_data.retention_forecast.retention_rate_30_days }}%</strong></p>
                                <p class="mb-0">–°–∏–ª–∞ —É–¥–µ—Ä–∂–∞–Ω–∏—è: <strong>{{ analytics_data.retention_forecast.retention_strength }}</strong></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-clock me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é</h6>
                                <p class="mb-2">–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π: <strong>{{ analytics_data.retention_forecast.recommended_review_frequency }}</strong></p>
                                <p class="mb-0">–ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è: <strong>{{ analytics_data.retention_forecast.materials_need_review }}</strong></p>
                            </div>
                        </div>
                    </div>

                    <!-- –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                    {% if analytics_data.complexity_analysis %}
                    <h4 class="mb-3">üìä –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h4>
                    <div class="row">
                        {% for complexity in analytics_data.complexity_analysis %}
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded mb-3">
                                <div class="h5 
                                    {% if complexity.complexity == '–ü—Ä–æ—Å—Ç–æ–π' %}text-success
                                    {% elif complexity.complexity == '–°—Ä–µ–¥–Ω–∏–π' %}text-warning
                                    {% else %}text-danger{% endif %}">
                                    {{ complexity.complexity }}
                                </div>
                                <div class="small text-muted">{{ complexity.count }} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                                <div class="small">–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ: {{ complexity.avg_mastery }}/3</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å–∞–º -->
                    {% if analytics_data.productivity_by_hour %}
                    <h4 class="mb-3">‚è∞ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏</h4>
                    <div class="row">
                        {% for hour_data in analytics_data.productivity_by_hour[:6] %}
                        <div class="col-md-2">
                            <div class="text-center p-2 bg-light rounded mb-2">
                                <div class="h6 text-primary">{{ hour_data.hour }}</div>
                                <div class="small text-muted">{{ hour_data.performance }}/3</div>
                                <div class="small">{{ hour_data.documents }} –¥–æ–∫.</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                    {% if analytics_data.content_analysis %}
                    <h4 class="mb-3 mt-4">üìÑ –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h4>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–¢–∏–ø —Ñ–∞–π–ª–∞</th>
                                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                    <th>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞</th>
                                    <th>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for content in analytics_data.content_analysis %}
                                <tr>
                                    <td><span class="badge bg-secondary">{{ content.file_type }}</span></td>
                                    <td>{{ content.count }}</td>
                                    <td>{{ content.avg_summary_length }} —Å–∏–º–≤–æ–ª–æ–≤</td>
                                    <td>{{ content.avg_content_length }} —Å–∏–º–≤–æ–ª–æ–≤</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
                    <h4 class="mb-3 mt-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-primary">{{ analytics_data.usage_statistics.total_analyses }}</div>
                                <div class="small text-muted">–í—Å–µ–≥–æ –∞–Ω–∞–ª–∏–∑–æ–≤</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-info">{{ analytics_data.usage_statistics.chat_interactions }}</div>
                                <div class="small text-muted">AI –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-success">{{ analytics_data.usage_statistics.flashcard_reviews }}</div>
                                <div class="small text-muted">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –∫–∞—Ä—Ç–æ—á–µ–∫</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <div class="h4 text-warning">{{ analytics_data.usage_statistics.avg_question_length }}</div>
                                <div class="small text-muted">–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞</div>
                            </div>
                        </div>
                    </div>





                    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ -->
                    <h4 class="mb-3 mt-4">‚ö° –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PRO</h4>
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è:
                        <ul class="mt-2 mb-0">
                            <li>üîç –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤</li>
                            <li>üìä –ò–Ω—Å–∞–π—Ç—ã –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏</li>
                            <li>üöÄ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–Ω–¥–æ–≤</li>
                            <li>üß† –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∑–Ω–∞–Ω–∏–π</li>
                            <li>üìà –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</li>
                            <li>üéõÔ∏è –ö–∞—Å—Ç–æ–º–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã</li>
                            <li>üìÖ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã –∑–∞ 12 –º–µ—Å—è—Ü–µ–≤</li>
                        </ul>
                    </div>
                </div>
            {% endif %}

            <!-- –ö–Ω–æ–ø–∫–∞ –∞–ø–≥—Ä–µ–π–¥–∞ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞–Ω–æ–≤ –∫—Ä–æ–º–µ PRO -->
            {% if plan_type != 'pro' %}
            <div class="text-center mt-4">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    –•–æ—Ç–∏—Ç–µ –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏? 
                    <a href="{{ url_for('pricing') }}" class="btn btn-primary btn-sm ms-2">
                        –û–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω
                    </a>
                </div>
            </div>
            {% endif %}

        {% else %}
            <!-- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
            <div class="alert alert-warning text-center">
                <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                <h4>–î–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h4>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.</p>
                <button class="btn btn-primary" onclick="location.reload()">
                    <i class="fas fa-refresh me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        {% endif %}
    </div>
</div>

<script>
// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–≥–ª—É—à–∫–∞)
function exportData(format) {
    alert(`–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format} –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!`);
}
</script>
{% endblock %}