# üîç –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ª—É—á—à–µ–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤

## üöÄ –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –∏–Ω–æ–≥–¥–∞ –æ—Ç–∫–ª–æ–Ω—è–ª–∏—Å—å —Å–∏—Å—Ç–µ–º–æ–π –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–¥–µ–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ fallback-–º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏.

## üõ†Ô∏è –£–ª—É—á—à–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
```python
# –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
ALLOWED_EXTENSIONS = {'pdf', 'mp4', 'mov', 'mkv'}

# –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å MIME-—Ç–∏–ø–∞–º–∏
ALLOWED_EXTENSIONS = {
    'pdf': ['application/pdf', 'application/x-pdf'],
    'mp4': ['video/mp4', 'video/x-mp4'],
    'mov': ['video/quicktime', 'video/x-quicktime'],
    'mkv': ['video/x-matroska', 'video/mkv']
}
```

### 2. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

**–£—Ä–æ–≤–µ–Ω—å 1: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `filetype`**
- –ù–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –ê–Ω–∞–ª–∏–∑ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –±–∞–π—Ç–æ–≤

**–£—Ä–æ–≤–µ–Ω—å 2: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-magic`**
- Fallback –¥–ª—è `filetype`
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MIME-—Ç–∏–ø–æ–≤

**–£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ–∞–π–ª–æ–≤**
- –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ñ–∞–π–ª–æ–≤
- –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
def validate_file_content(file_obj, filename):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏"""
    # –ú–µ—Ç–æ–¥ 1: filetype
    # –ú–µ—Ç–æ–¥ 2: python-magic  
    # –ú–µ—Ç–æ–¥ 3: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä
    # –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

## üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

### PDF —Ñ–∞–π–ª—ã
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** `.pdf`
- **MIME-—Ç–∏–ø—ã:** `application/pdf`, `application/x-pdf`, `text/pdf`
- **–°–∏–≥–Ω–∞—Ç—É—Ä–∞:** `%PDF`

### MP4 –≤–∏–¥–µ–æ
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** `.mp4`
- **MIME-—Ç–∏–ø—ã:** `video/mp4`, `video/x-mp4`, `application/mp4`
- **–°–∏–≥–Ω–∞—Ç—É—Ä–∞:** `ftyp` –≤ –±–∞–π—Ç–∞—Ö 4-12

### MOV –≤–∏–¥–µ–æ
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** `.mov`
- **MIME-—Ç–∏–ø—ã:** `video/quicktime`, `video/x-quicktime`
- **–°–∏–≥–Ω–∞—Ç—É—Ä–∞:** `moov`, `mdat` –∏–ª–∏ QuickTime –∑–∞–≥–æ–ª–æ–≤–∫–∏

### MKV –≤–∏–¥–µ–æ
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** `.mkv`
- **MIME-—Ç–∏–ø—ã:** `video/x-matroska`, `video/mkv`
- **–°–∏–≥–Ω–∞—Ç—É—Ä–∞:** `\x1a\x45\xdf\xa3`

## üîß –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### `allowed_file(filename)`
–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π:
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ—á–∫–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### `validate_file_content(file_obj, filename)`
–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:
- –ß—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 2KB —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–∞
- –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

### `_check_file_signature(content, extension)`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –±–∞–π—Ç–æ–≤:
- PDF: `%PDF`
- MP4/MOV: `ftyp`, `moov`, `mdat`
- MKV: —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ Matroska

### `_is_compatible_mime_type(mime, extension)`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ MIME-—Ç–∏–ø–æ–≤:
- –£—á–µ—Ç –≤–∞—Ä–∏–∞—Ü–∏–π MIME-—Ç–∏–ø–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

```bash
python test_file_validation.py
```

**–¢–µ—Å—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ–∞–π–ª–æ–≤
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å MIME-—Ç–∏–ø–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

## üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `requirements.txt`:
```
# PDF Processing (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
PyPDF2
pdfplumber

# File type detection
python-magic
filetype
```

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Graceful Degradation
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã:
1. –ï—Å–ª–∏ `filetype` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `python-magic`
2. –ï—Å–ª–∏ `python-magic` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä
3. –ï—Å–ª–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí —Ñ–∞–π–ª –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ MIME-—Ç–∏–ø–æ–≤ ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
- –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
- –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–≥—Ä—É–∑–∫—É

## üöÄ –£–ª—É—á—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

### –í `ml.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã:

**`_detect_file_type(filepath)`**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ–∞–π–ª–∞
- Fallback –¥–ª—è —Ñ–∞–π–ª–æ–≤ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

**`_extract_pdf_alternative(filepath)`**
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è PDF
- PyPDF2 –∏ pdfplumber –∫–∞–∫ fallback

**`_clean_extracted_text(text)`**
- –û—á–∏—Å—Ç–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ OCR
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
if not os.path.exists(filepath):
    raise ValueError(f"File not found: {filepath}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
file_size = os.path.getsize(filepath)
if file_size == 0:
    raise ValueError("File is empty")

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
if len(text) < 50:
    raise ValueError(f"Text too short ({len(text)} chars)")
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚ùå –§–∞–π–ª—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –æ—Ç–∫–ª–æ–Ω—è–ª–∏—Å—å
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤
- ‚ùå –°–ª–∞–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚ùå –û–¥–∏–Ω –º–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–æ–≤
- ‚úÖ Graceful degradation
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üîÆ –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- üîÑ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (DOCX, PPTX)
- üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- üîÑ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- üîÑ –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–û–±–Ω–æ–≤–ª—è–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
4. **–°–æ–±–∏—Ä–∞–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å** –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∑–∞–≥—Ä—É–∑–∫–æ–π

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞–ª–∞ –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∏ —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∞–º –∏ –≤–∞—Ä–∏–∞—Ü–∏—è–º —Ñ–∞–π–ª–æ–≤! üéâ