# üéØ –£–ª—É—á—à–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–π—Ç–∏–Ω–≥–µ

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "üåü –í—ã –≤ —Ç–æ–ø-2!" –ø–æ—è–≤–ª—è–ª–æ—Å—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ —Ç–æ–ø-5, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ —Å–ø–∞–º –∏ —Ä–∞–∑–¥—Ä–∞–∂–∞–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏**.

### üóÑÔ∏è **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

#### **–ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `007_add_last_leaderboard_rank.py`:**
```sql
ALTER TABLE users ADD COLUMN last_leaderboard_rank INTEGER DEFAULT NULL;
ALTER TABLE users ADD COLUMN last_rank_update TIMESTAMP DEFAULT NULL;
```

#### **–ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- `last_leaderboard_rank` - –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
- `last_rank_update` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏

### üîÑ **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

#### **–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```javascript
if (user_rank && user_rank <= 5) {
    // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑
    notifications.append({...});
}
```

#### **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```javascript
if (user_rank && user_rank <= 5) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    if (last_rank != user_rank) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
        notifications.append({...});
    }
}
```

### üìä **–¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**

#### **1. –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –≤ —Ç–æ–ø–µ:**
```json
{
  "title": "üåü –í—ã –≤ —Ç–æ–ø-2!",
  "message": "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤–ø–µ—Ä–≤—ã–µ –ø–æ–ø–∞–ª–∏ –≤ —Ç–æ–ø-2 —Ä–µ–π—Ç–∏–Ω–≥–∞!"
}
```

#### **2. –ü–æ–¥–Ω—è–ª–∏—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:**
```json
{
  "title": "üìà –í—ã –ø–æ–¥–Ω—è–ª–∏—Å—å –Ω–∞ 1 –ø–æ–∑–∏—Ü–∏—é!",
  "message": "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢–µ–ø–µ—Ä—å –≤—ã –Ω–∞ 1 –º–µ—Å—Ç–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ!"
}
```

#### **3. –û–ø—É—Å—Ç–∏–ª–∏—Å—å (–Ω–æ –æ—Å—Ç–∞–ª–∏—Å—å –≤ —Ç–æ–ø-5):**
```json
{
  "title": "üìä –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ",
  "message": "–í—ã –Ω–∞ 3 –º–µ—Å—Ç–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!"
}
```

### üéØ **–£—Å–ª–æ–≤–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

| –°–∏—Ç—É–∞—Ü–∏—è | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
|----------|----------------------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–æ–ø-5, –ø–æ–∑–∏—Ü–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å | ‚ùå –ù–ï–¢ |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –ø–æ–ø–∞–ª –≤ —Ç–æ–ø-5 | ‚úÖ –î–ê |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–Ω—è–ª—Å—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ | ‚úÖ –î–ê |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø—É—Å—Ç–∏–ª—Å—è, –Ω–æ –æ—Å—Ç–∞–ª—Å—è –≤ —Ç–æ–ø-5 | ‚úÖ –î–ê |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–∞–ª –∏–∑ —Ç–æ–ø-5 | ‚ùå –ù–ï–¢ |

### üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

#### **–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
2. –ß–∏—Ç–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏–∑ –ë–î
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏: `last_rank != user_rank`
4. –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å:
   - –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –ë–î
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –ë–î:**
```sql
UPDATE users 
SET last_leaderboard_rank = ?, last_rank_update = CURRENT_TIMESTAMP 
WHERE id = ?
```

### üìà **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

#### **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- ‚úÖ **–ù–µ—Ç —Å–ø–∞–º–∞** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –∑–Ω–∞—é—Ç –æ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ **–ú–æ—Ç–∏–≤–∞—Ü–∏—è** - –≤–∏–¥—è—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

#### **–î–ª—è —Å–∏—Å—Ç–µ–º—ã:**
- ‚úÖ **–ú–µ–Ω—å—à–µ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ë–æ–ª–µ–µ —Ü–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚úÖ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** –ø–æ–∑–∏—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π** —Ä–µ–π—Ç–∏–Ω–≥–∞

### üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

#### **–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. **–ü–µ—Ä–≤—ã–π —Ä–∞–∑ –≤ —Ç–æ–ø–µ:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—ã–ª –≤ —Ç–æ–ø-5
   - –ù–∞–±–∏—Ä–∞–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP –¥–ª—è –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Ç–æ–ø-5
   - –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–≤–ø–µ—Ä–≤—ã–µ –ø–æ–ø–∞–ª–∏"

2. **–ü–æ–≤—ã—à–µ–Ω–∏–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –Ω–∞ 3 –º–µ—Å—Ç–µ
   - –ü–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ 1 –º–µ—Å—Ç–æ
   - –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ø–æ–¥–Ω—è–ª–∏—Å—å –Ω–∞ 2 –ø–æ–∑–∏—Ü–∏–∏"

3. **–ü–æ–Ω–∏–∂–µ–Ω–∏–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –Ω–∞ 1 –º–µ—Å—Ç–µ
   - –û–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ 4 –º–µ—Å—Ç–æ
   - –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ"

4. **–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ù–ï –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è

### üìä **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**

```python
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 8 –±—ã–ª –Ω–∞ 2 –º–µ—Å—Ç–µ
last_rank = 2

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞ 1 –º–µ—Å—Ç–æ  
current_rank = 1

# –£—Å–ª–æ–≤–∏–µ: last_rank != current_rank (2 != 1) = True
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "üìà –í—ã –ø–æ–¥–Ω—è–ª–∏—Å—å –Ω–∞ 1 –ø–æ–∑–∏—Ü–∏—é!"

# –û–±–Ω–æ–≤–∏—Ç—å –≤ –ë–î: last_leaderboard_rank = 1
```

### üìÅ **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. **`migrations/007_add_last_leaderboard_rank.py`** - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
2. **`app.py`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–π—Ç–∏–Ω–≥–µ

---

## ‚úÖ **–°—Ç–∞—Ç—É—Å: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

–°–∏—Å—Ç–µ–º–∞ —É–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Ä–µ–π—Ç–∏–Ω–≥–µ –≥–æ—Ç–æ–≤–∞! –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å–≤–æ–µ–π –ø–æ–∑–∏—Ü–∏–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –±–æ–ª–µ–µ —Ü–µ–Ω–Ω—ã–º–∏ –∏ –º–µ–Ω–µ–µ —Ä–∞–∑–¥—Ä–∞–∂–∞—é—â–∏–º–∏. üéâ